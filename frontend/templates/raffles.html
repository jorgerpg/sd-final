{% extends "base.html" %}
{% block content %}

<div class="d-flex flex-column flex-md-row justify-content-between gap-3 align-items-md-center mb-4">
    <div>
        <h3 class="mb-1">Sorteios</h3>
        <p class="text-muted mb-0">Busque por título ou visualize somente os seus.</p>
    </div>

    <div class="d-flex gap-2 flex-wrap">
        {% if session.user %}
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
          + Criar sorteio
        </button>
        {% endif %}
    </div>
</div>

<form class="card shadow-sm p-3 mb-4" method="GET" action="/raffles">
  <div class="row g-2 align-items-end">
    <div class="col-md-6">
      <label class="form-label text-muted small mb-1" for="search-input">Buscar por nome</label>
      <input id="search-input"
             class="form-control"
             type="text"
             name="q"
             placeholder="Digite o título do sorteio"
             value="{{ filters.q }}">
    </div>

    {% if session.user %}
    <div class="col-md-3 d-flex align-items-center">
      <div class="form-check mt-3 mt-md-0">
        <input class="form-check-input"
               type="checkbox"
               value="1"
               id="mine-filter"
               name="mine"
               {% if filters.mine %}checked{% endif %}>
        <label class="form-check-label" for="mine-filter">
          Mostrar apenas meus sorteios
        </label>
      </div>
    </div>
    {% endif %}

    <div class="col-md-3 text-md-end">
      <button class="btn btn-outline-secondary w-100">
        Aplicar filtros
      </button>
    </div>
  </div>
</form>

<div class="row">

{% if raffles %}
  {% for r in raffles %}
    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5>{{ r.title }}</h5>
          <p class="mb-1">Status: <strong>{{ r.status }}</strong></p>
          <small class="text-muted">Criador: {{ r.creator_id }}</small>
          <a href="/raffles/{{ r.id }}" class="btn btn-outline-primary w-100 mt-3">Ver detalhes</a>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <div class="col-12">
    <div class="alert alert-info">
      Nenhum sorteio encontrado com os filtros atuais.
    </div>
  </div>
{% endif %}

</div>

<!-- MODAL CRIAR SORTEIO -->
<div class="modal fade" id="modalCreate" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" action="/raffles/create" method="POST">

      <div class="modal-header">
        <h5 class="modal-title">Novo sorteio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input class="form-control mb-2" name="title" placeholder="Título">
        <textarea class="form-control" name="description" placeholder="Descrição"></textarea>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success">Criar</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
